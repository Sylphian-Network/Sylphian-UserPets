<xf:title>{{ phrase('sylphian_userpets_spritesheet_management') }}</xf:title>

<xf:if is="$hasPathIssues">
    <div class="blockMessage blockMessage--error blockMessage--iconic">
        <ul class="listPlain">
            <xf:foreach loop="$pathHealth" value="$ph">
                <xf:if is="!$ph.exists">
                    <li>{{ phrase_dynamic('sylphian_userpets_path_does_not_exist', {'path': $ph.path}) }}</li>
                    <xf:else />
                    <li>{$ph.path} [readable: {{ $ph.readable ? 'yes' : 'no' }}, writable: {{ $ph.writable ? 'yes' : 'no' }}]</li>
                </xf:if>
            </xf:foreach>
        </ul>
        <br>
        <div class="u-muted">{{ phrase('sylphian_userpets_spritesheet_path_error') }}</div>
    </div>
</xf:if>

<xf:pageaction>
    <xf:button href="{{ link('sylphian_userpets/spritesheets/add') }}" overlay="true" icon="add">
        {{ phrase('sylphian_userpets_add_spritesheet') }}
    </xf:button>
</xf:pageaction>

<div class="block">
    <div class="block-container">
        <h3 class="block-header">{{ phrase('sylphian_userpets_existing_spritesheets') }}</h3>
        <div class="block-body">
            <xf:datalist>
                <xf:datarow rowtype="header">
                    <xf:cell>{{ phrase('preview') }}</xf:cell>
                    <xf:cell>{{ phrase('filename') }}</xf:cell>
                    <xf:cell>{{ phrase('details') }}</xf:cell>
                    <xf:cell>{{ phrase('size') }}</xf:cell>
                    <xf:cell>{{ phrase('last_modified') }}</xf:cell>
                    <xf:cell></xf:cell>
                    <xf:cell></xf:cell>
                    <xf:cell></xf:cell>
                </xf:datarow>

                <xf:if is="$files">
                    <xf:foreach loop="$files" value="$f">
                        <xf:datarow>
                            <xf:cell>
								<div class="sprite-preview">
									<img src="{$f.url}"
										 alt="{$f.name}"
										 data-xf-init="syl-sprite-preview"
										 data-src="{$f.url}"
										 data-fps="{{ $f.entity ? $f.entity.fps : 4 }}"
										 data-frame-w="{{ $f.entity ? $f.entity.frame_width : 32 }}"
										 data-frame-h="{{ $f.entity ? $f.entity.frame_height : 32 }}"
										 data-cols="{{ $f.entity ? $f.entity.frames_per_animation : 4 }}"
										 data-rows="4"
										 data-scale="1"
										 data-pixelated="true" />
								</div>
							</xf:cell>

                            <xf:main label="{$f.name}" />

                            <xf:cell>
							  <span class="u-muted">{{ $f.entity
								? ("Frame size: {$f.entity.frame_width}×{$f.entity.frame_height}<br>
								  Frames per animation: {$f.entity.frames_per_animation}<br>
								  Frames per second: {$f.entity.fps}")
								: '—'
							  }}</span>
                            </xf:cell>

                            <xf:cell>{{ file_size($f.size) }}</xf:cell>
                            <xf:cell>{{ date_time($f.mtime) }}</xf:cell>

                            <xf:cell class="dataList-cell--action">
                                <a href="{$f.url}" target="_blank" class="menuTrigger" data-xf-init="tooltip"
                                   title="{{ phrase('view') }}">
                                    <xf:fa icon="fa-search" />
                                </a>
                            </xf:cell>

                            <xf:cell class="dataList-cell--action">
                                <a href="{{ link('sylphian_userpets/spritesheets/edit', null, {'file': $f.name}) }}"
                                   data-xf-click="overlay" class="menuTrigger" title="{{ phrase('edit') }}">
                                    <xf:fa icon="fa-cog" />
                                </a>
                            </xf:cell>

                            <xf:action href="{{ link('sylphian_userpets/spritesheets/delete', null, {'file': $f.name}) }}"
                                       overlay="true"
                                       title="{{ phrase('delete') }}">
                                <xf:fa icon="fa-trash" />
                            </xf:action>
                        </xf:datarow>
                    </xf:foreach>
                    <xf:else />
                    <xf:datarow rowtype="subsection">
                        <xf:cell colspan="8">
                            <div class="block-rowMessage">{{ phrase('sylphian_userpets_no_spritesheet') }}</div>
                        </xf:cell>
                    </xf:datarow>
                </xf:if>
            </xf:datalist>
        </div>
    </div>
</div>

<xf:css>
.sprite-preview {
  width: 200px;
  height: 200px;
  display: inline-flex;
  overflow: hidden;
}

.sprite-preview canvas,
.sprite-preview img {
  max-width: 100%;
  max-height: 100%;
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
  border-radius: 2px;
}
</xf:css>

<xf:js src="sylphian/userpets/sprite-preview.js" min="1" addon="Sylphian/UserPets" />